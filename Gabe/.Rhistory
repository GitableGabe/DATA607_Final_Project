# Chunk 9
df_tb10_tdy<-
as.data.frame(df_tb10[1,]%>%
assign_in(list(1,1),"Month")%>%
bind_rows(df_tb10[3:14,],
df_tb10[16:27,],
df_tb10[29:40,])
)
# Adding male and female category
df_tb10_tdy$Gender<-"Total"
df_tb10_tdy$Gender[14:25] <- "Male"
df_tb10_tdy$Gender[26:37] <- "Female"
# Chunk 10
#Dependency on df_tb10_tdy    Rate, Gender, Age Group
df_tb10_ln <- as.data.frame(df_tb10_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Rate", 2:14)%>%
lapply(function(x){
gsub(",", "", x)}))
# Chunk 11
df_tb10_ln$Month_Year<- as.yearmon(df_tb10_ln$Month_Year)
df_tb10_ln$Rate <- as.numeric(df_tb10_ln$Rate)
# Chunk 12
head(df_tb10_ln[with(df_tb10_ln, order(-Rate)),])%>%
kbl(row.names = FALSE) %>%
kable_styling(bootstrap_options = "striped",position = "center", full_width = T)
# Chunk 13
# Month over Month employment rate change by gender
#Dependency on df_tb9_tdy:     Rate and Gender
df_tb9_rt <- df_tb9_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Count", 2:14)
df_tb9_rt$Month_Year<- as.yearmon(df_tb9_rt$Month_Year)
df_tb9_rt$Count <- as.numeric(gsub(",","",df_tb9_rt$Count))
df_tb9_rt <-
df_tb9_rt %>%
group_by(Gender) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 2))
# Chunk 14
head(df_tb9_rt[with(df_tb9_rt, order(- MoM_Rate)),])%>%
kbl(row.names = FALSE) %>%
kable_paper(bootstrap_options = "striped", full_width = F)
# Chunk 15
# Month over Month employment rate change by age and gender
#Dependency on df_tb9_tdy:     Count, age, and Gender
df_tb9_MoM <- df_tb9_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Count", 2:14)
df_tb9_MoM$Month_Year<- as.yearmon(df_tb9_MoM$Month_Year)
df_tb9_MoM$Count <- as.numeric(gsub(",","",df_tb9_MoM$Count))
df_tb9_MoM <- df_tb9_MoM %>%
group_by(Gender, Label) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 1))
# Chunk 16
arrange(df_tb9_MoM,Label)[15:25,]%>%
kbl(row.names = FALSE) %>%
kable_paper(bootstrap_options = "striped", full_width = F)
# Chunk 17
#Dependency on df_tb10_tdy:     Rate and Gender
#data transformation operation: from wide to long function: gather, package: tidyr
df_tb10_trend <- df_tb10_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Rate", 2:14)
#data transformation operation: date format function: as.yearmon, package: zoo
df_tb10_trend$Month_Year<- as.yearmon(df_tb10_trend$Month_Year)
df_tb10_trend$Rate <- as.numeric(df_tb10_trend$Rate)
# Chunk 18
head(df_tb10_trend,5)%>%
kbl(row.names = FALSE) %>%
kable_classic("striped", full_width = F)
# Chunk 19
df_ml_rt <-
df_tb9_rt%>%
filter(Gender == "Male")%>%
select(- Count,- MoM)
df_fml_rt <-
df_tb9_rt%>%
filter(Gender == "Female")%>%
select(- Count,- MoM)
list_max<-pmax(df_ml_rt$MoM_Rate,df_fml_rt$MoM_Rate)
# Chunk 20
(df_max<-
df_tb9_rt%>%
filter(MoM_Rate == list_max)%>%
select(- Count,- MoM))%>%kbl(row.names = FALSE) %>%
kable_styling(bootstrap_options = "striped",position = "center", full_width = T)
# Chunk 21
#testing linear model. issue: gender is categorical var- need to look into this
# only accounts for 1.18% of data, Multiple R-squared:  0.0118
summary(lm(Count~Gender, df_tb9_rt))
plot(lm(Count~Gender, df_tb9_rt))
ggplot(test3, aes(x=factor(Month_Year), y = (Rate), color = Gender, group = Gender, fill=Gender)) +
geom_col(position="dodge") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust=1))+
labs(title = 'Unemployment Rates by Gender'
,subtitle = "03/2020-03/2021",
x = "Month", y = "Rate")
# Chunk 1
# install.packages("rio")
# ^^^^ only if needed
library(httr)
library(readxl)
library(rio)
library(rvest)
library(tidyverse)
library(lubridate)
library(zoo)
library(stats)
library(scales)
# Chunk 2
url_9  <- "https://www.bls.gov/web/empsit/cpseea09.htm"
url_10 <- "https://www.bls.gov/web/empsit/cpseea10.htm"
url_34 <- "https://www.bls.gov/cps/cpsaat34.htm"
url_34_xsls <- "https://www.bls.gov/cps/cpsaat34.xlsx"
# Chunk 3
head(df_tb9  <- as.data.frame(html_table(read_html(url_9))[[2]]),5)
head(df_tb10 <- as.data.frame(html_table(read_html(url_10))[[2]]),5)
head(df_tb34 <- as.data.frame(html_table(read_html(url_34))[[2]]),5)
# Chunk 4
colnames(df_tb10) <- cbind(c("Label","2020-03", "2020-04",
"2020-05", "2020-06", "2020-07",
"2020-08", "2020-09", "2020-10",
"2020-11", "2020-12","2021-01",
"2021-02", "2021-03"))
colnames(df_tb9) <- c("Label", "2020-03", "2020-04",
"2020-05", "2020-06", "2020-07",
"2020-08", "2020-09", "2020-10",
"2020-11", "2020-12","2021-01",
"2021-02", "2021-03")
# Chunk 5
df_tb9_tdy<-
as.data.frame(df_tb9[1,]%>%
assign_in(list(1,1),"Month")%>%
bind_rows(
df_tb9[3,],
(df_tb9[4:14,]%>%
select(1)%>%
#lapply(function(x){ gsub("^", "Total, ", x)})%>%
cbind(df_tb9[4:14,2:14])),
df_tb9[16,],
(df_tb9[17:27,]%>%
select(1)%>%
#lapply(function(x){gsub("^", "Men, ", x)})%>%
cbind(df_tb9[17:27,2:14])),
df_tb9[29,],
(df_tb9[30:40,]%>%
select(1)%>%
#lapply(function(x){gsub("^", "Women, ", x)})%>%
cbind(df_tb9[30:40,2:14]))
)
)
# # Adding male and female category
# df_tb9_tdy$Gender <- ifelse(grepl("Men,", df_tb9_tdy$Label), "Male",
#                             ifelse(grepl("Women,", df_tb9_tdy$Label), "Female", ""))
df_tb9_tdy$Gender <- "Total"
df_tb9_tdy$Gender[14:25] <- "Male"
df_tb9_tdy$Gender[26:37] <- "Female"
# Chunk 6
df_tb10_tdy<-
as.data.frame(df_tb10[1,]%>%
assign_in(list(1,1),"Month")%>%
bind_rows(df_tb10[3,],(df_tb10[4:14,]%>%
select(1)%>%
#lapply(function(x){gsub("^", "Total, ", x)})%>%
cbind(df_tb10[4:14,2:14])),
df_tb10[16,],
(df_tb10[17:27,]%>%
select(1)%>%
#lapply(function(x){gsub("^", "Men, ", x)})%>%
cbind(df_tb10[17:27,2:14])),
df_tb10[29,],
(df_tb10[30:40,]%>%
select(1)%>%
#lapply(function(x){gsub("^", "Women, ", x)})%>%
cbind(df_tb10[30:40,2:14]))))
# Adding male and female category
# df_tb10_tdy$Gender <- ifelse(grepl("Men,", df_tb10_tdy$Label), "Male",
#                             ifelse(grepl("Women,", df_tb10_tdy$Label), "Female", ""))
df_tb10_tdy$Gender <- "Total"
df_tb10_tdy$Gender[14:25] <- "Male"
df_tb10_tdy$Gender[26:37] <- "Female"
# Chunk 7
df_tb9_tdy_t <-
df_tb9_tdy%>%
rownames_to_column() %>%
pivot_longer(-rowname, 'variable', 'value') %>%
pivot_wider(variable, rowname)%>%
janitor::row_to_names(1)
# Chunk 8
df_tb10_tdy_t <-
df_tb10_tdy%>%
rownames_to_column() %>%
pivot_longer(-rowname, 'variable', 'value') %>%
pivot_wider(variable, rowname)%>%
janitor::row_to_names(1)
# Chunk 9
# df_tb9_tdy_ts <-
#   df_tb9_tdy_t %>%
#   select(1,2,3,15,4,16,5,17,6,18,7,19,8,20,9,21,10,22,11,23,12,24,13,25,14,26)
# Chunk 10
test<- df_tb10_tdy[,1:14]%>%
rbind(df_tb10_tdy[c(14,26),1:14]) %>%
gather("Month_Year", "Rate", 2:14)
# Chunk 11
# Month over Month employment rate change by gender
#Dependency on df_tb9_tdy:     Rate and Gender
t_9 <- df_tb9_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Count", 2:14)
t_9$Month_Year<- as.yearmon(t_9$Month_Year)
t_9$Count <- as.numeric(gsub(",","",t_9$Count))
#glimpse(t_9)
t_9 <- t_9 %>%
group_by(Gender) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 1))
##bar plot month over month gender
ggplot(t_9, aes(x=factor(Month_Year), y=MoM, fill=Gender)) +
geom_col(position="dodge") +
scale_y_continuous(labels = scales::percent)+
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust=1))+
labs(title = 'Month over Month Employment Rate Change by Gender'
,subtitle = "03/2020-03/2021",
x = "Month", y = "Rate Chnage")
#testing linear model. issue: gender is categorical var- need to look into this
# only accounts for 1.18% of data, Multiple R-squared:  0.0118
hist(t_9$Count)
tst_lm <- lm(Count~Gender, t_9)
tst_lm
summary(tst_lm)
# Chunk 12
# Month over Month employment rate change by age and gender
#Dependency on df_tb9_tdy:     Count, age, and Gender
library(stats)
tbl_9 <- df_tb9_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Count", 2:14)
tbl_9$Month_Year<- as.yearmon(tbl_9$Month_Year)
tbl_9$Count <- as.numeric(gsub(",","",tbl_9$Count))
#glimpse(tbl_9)
tbl_9 <- tbl_9 %>%
group_by(Gender, Label) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 1))
##bar plot month over month age grp and geneder
(ggplot(tbl_9, aes(x=factor(Month_Year), y = (MoM), color = Gender, group = Gender, fill=Gender)) +
geom_col(position="dodge") +
theme_minimal()+
theme(axis.text.x = element_text(angle=45, hjust=1))+
labs(title= 'Month over Month Employment Rate Change by Gender',
subtitle="03/2020-03/2021",
x="Month", y="Rate Change")+
facet_wrap( ~ Label, scales = "free_y"))
# Chunk 13
#Dependency on df_tb10_tdy:     Rate and Gender
#data transformation operation: from wide to long function: gather, package: tidyr
test3 <- df_tb10_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Rate", 2:14)
#data transformation operation: date format function: as.yearmon, package: zoo
test3$Month_Year<- as.yearmon(test3$Month_Year)
test3$Rate <- as.numeric(test3$Rate)
# Chunk 14
#Dependency on df_tb10_tdy    Rate, Gender, Age Group
test2 <- df_tb10_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Rate", 2:14)
test2$Month_Year<- as.yearmon(test2$Month_Year)
test2$Rate <- as.numeric(test2$Rate)
ggplot(test3, aes(x=factor(Month_Year), y = (Rate), color = Gender, group = Gender, fill=Gender)) +
geom_col(position="dodge") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust=1))+
labs(title = 'Unemployment Rates by Gender'
,subtitle = "03/2020-03/2021",
x = "Month", y = "Rate")
# Chunk 1
# install.packages("rio")
# ^^^^ only if needed
library(httr)
library(kableExtra)
library(lubridate)
library(readxl)
library(rio)
library(reactable)
library(rvest)
library(tidyverse)
library(zoo)
# Chunk 2
url_9  <- "https://www.bls.gov/web/empsit/cpseea09.htm"
url_10 <- "https://www.bls.gov/web/empsit/cpseea10.htm"
# Chunk 3
#url_34 <- "https://www.bls.gov/cps/cpsaat34.htm"
#url_34_xsls <- "https://www.bls.gov/cps/cpsaat34.xlsx"
# Chunk 4
head(df_tb9  <- as.data.frame(html_table(read_html(url_9))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 5
head(df_tb10 <- as.data.frame(html_table(read_html(url_10))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 6
#head(df_tb34 <- as.data.frame(html_table(read_html(url_34))[[2]]),5)
# Chunk 7
colnames(df_tb10) <- c("Label","2020-03", "2020-04",
"2020-05", "2020-06", "2020-07",
"2020-08", "2020-09", "2020-10",
"2020-11", "2020-12","2021-01",
"2021-02", "2021-03")
colnames(df_tb9) <- c("Label", "2020-03", "2020-04",
"2020-05", "2020-06", "2020-07",
"2020-08", "2020-09", "2020-10",
"2020-11", "2020-12","2021-01",
"2021-02", "2021-03")
# Chunk 8
df_tb9_tdy<-
as.data.frame(df_tb9[1,]%>%
assign_in(list(1,1),"Month")%>%
bind_rows(df_tb9[3:14,],
df_tb9[16:27,],
df_tb9[29:40,])
)
# Adding male and female category
df_tb9_tdy$Gender<-"Total"
df_tb9_tdy$Gender[14:25] <- "Male"
df_tb9_tdy$Gender[26:37] <- "Female"
# Chunk 9
df_tb10_tdy<-
as.data.frame(df_tb10[1,]%>%
assign_in(list(1,1),"Month")%>%
bind_rows(df_tb10[3:14,],
df_tb10[16:27,],
df_tb10[29:40,])
)
# Adding male and female category
df_tb10_tdy$Gender<-"Total"
df_tb10_tdy$Gender[14:25] <- "Male"
df_tb10_tdy$Gender[26:37] <- "Female"
# Chunk 10
#Dependency on df_tb10_tdy    Rate, Gender, Age Group
df_tb10_ln <- as.data.frame(df_tb10_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Rate", 2:14)%>%
lapply(function(x){
gsub(",", "", x)}))
# Chunk 11
df_tb10_ln$Month_Year<- as.yearmon(df_tb10_ln$Month_Year)
df_tb10_ln$Rate <- as.numeric(df_tb10_ln$Rate)
# Chunk 12
head(df_tb10_ln[with(df_tb10_ln, order(-Rate)),])%>%
kbl(row.names = FALSE) %>%
kable_styling(bootstrap_options = "striped",position = "center", full_width = T)
# Chunk 13
# Month over Month employment rate change by gender
#Dependency on df_tb9_tdy:     Rate and Gender
df_tb9_rt <- df_tb9_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Count", 2:14)
df_tb9_rt$Month_Year<- as.yearmon(df_tb9_rt$Month_Year)
df_tb9_rt$Count <- as.numeric(gsub(",","",df_tb9_rt$Count))
df_tb9_rt <-
df_tb9_rt %>%
group_by(Gender) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 2))
# Chunk 14
head(df_tb9_rt[with(df_tb9_rt, order(- MoM_Rate)),])%>%
kbl(row.names = FALSE) %>%
kable_paper(bootstrap_options = "striped", full_width = F)
# Chunk 15
# Month over Month employment rate change by age and gender
#Dependency on df_tb9_tdy:     Count, age, and Gender
df_tb9_MoM <- df_tb9_tdy %>%
slice(c(16,17,19,22,23,24,25,28,29,31,34,35,36,37)) %>%
gather("Month_Year", "Count", 2:14)
df_tb9_MoM$Month_Year<- as.yearmon(df_tb9_MoM$Month_Year)
df_tb9_MoM$Count <- as.numeric(gsub(",","",df_tb9_MoM$Count))
df_tb9_MoM <- df_tb9_MoM %>%
group_by(Gender, Label) %>%
mutate(MoM = (Count - lag(Count)) / lag(Count)) %>%
mutate(MoM_Rate =  round(MoM * 100, 1))
# Chunk 16
arrange(df_tb9_MoM,Label)[15:25,]%>%
kbl(row.names = FALSE) %>%
kable_paper(bootstrap_options = "striped", full_width = F)
# Chunk 17
#Dependency on df_tb10_tdy:     Rate and Gender
#data transformation operation: from wide to long function: gather, package: tidyr
df_tb10_trend <- df_tb10_tdy %>%
slice(c(14,26)) %>%
gather("Month_Year", "Rate", 2:14)
#data transformation operation: date format function: as.yearmon, package: zoo
df_tb10_trend$Month_Year<- as.yearmon(df_tb10_trend$Month_Year)
df_tb10_trend$Rate <- as.numeric(df_tb10_trend$Rate)
# Chunk 18
head(df_tb10_trend,5)%>%
kbl(row.names = FALSE) %>%
kable_classic("striped", full_width = F)
# Chunk 19
df_ml_rt <-
df_tb9_rt%>%
filter(Gender == "Male")%>%
select(- Count,- MoM)
df_fml_rt <-
df_tb9_rt%>%
filter(Gender == "Female")%>%
select(- Count,- MoM)
list_max<-pmax(df_ml_rt$MoM_Rate,df_fml_rt$MoM_Rate)
# Chunk 20
(df_max<-
df_tb9_rt%>%
filter(MoM_Rate == list_max)%>%
select(- Count,- MoM))%>%kbl(row.names = FALSE) %>%
kable_styling(bootstrap_options = "striped",position = "center", full_width = T)
# Chunk 21
#testing linear model. issue: gender is categorical var- need to look into this
# only accounts for 1.18% of data, Multiple R-squared:  0.0118
summary(lm(Count~Gender, df_tb9_rt))
# Chunk 22
plot(lm(Count~Gender, df_tb9_rt))
ggplot(df_tb10_trend, aes(x=factor(Month_Year), y = (Rate), color = Gender, group = Gender)) +
geom_col(position="dodge") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust=1))+
labs(title = 'Unemployment Rates by Gender'
,subtitle = "03/2020-03/2021",
x = "Month", y = "Rate")
# Chunk 1
# install.packages("rio")
# ^^^^ only if needed
library(httr)
library(kableExtra)
library(lubridate)
library(readxl)
library(rio)
library(reactable)
library(rvest)
library(tidyverse)
library(zoo)
# Chunk 2
url_9  <- "https://www.bls.gov/web/empsit/cpseea09.htm"
url_10 <- "https://www.bls.gov/web/empsit/cpseea10.htm"
url_30 <- "https://www.bls.gov/web/empsit/cpseea30.htm"
# Chunk 3
head(df_tb9  <- as.data.frame(html_table(read_html(url_9))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 4
head(df_tb10 <- as.data.frame(html_table(read_html(url_10))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
head(df_tb30 <- as.data.frame(html_table(read_html(url_30))[[[3]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 1
# install.packages("rio")
# ^^^^ only if needed
library(httr)
library(kableExtra)
library(lubridate)
library(readxl)
library(rio)
library(reactable)
library(rvest)
library(tidyverse)
library(zoo)
# Chunk 2
url_9  <- "https://www.bls.gov/web/empsit/cpseea09.htm"
url_10 <- "https://www.bls.gov/web/empsit/cpseea10.htm"
url_30 <- "https://www.bls.gov/web/empsit/cpseea30.htm"
# Chunk 3
head(df_tb9  <- as.data.frame(html_table(read_html(url_9))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 4
head(df_tb10 <- as.data.frame(html_table(read_html(url_10))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
head(df_tb30 <- as.data.frame(html_table(read_html(url_30))[[3]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
head(df_tb30 <- as.data.frame(html_table(read_html(url_30))[[3]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
html_table(read_html(url_30))
x <- html_table(read_html(url_30))
View(x)
x <- html_table(read_html(url_30[[2]]))
x <- html_table(read_html(url_30))[[2]]
View(x)
View(x)
# Chunk 1
# install.packages("rio")
# ^^^^ only if needed
library(httr)
library(kableExtra)
library(lubridate)
library(readxl)
library(rio)
library(reactable)
library(rvest)
library(tidyverse)
library(zoo)
# Chunk 2
url_9  <- "https://www.bls.gov/web/empsit/cpseea09.htm"
url_10 <- "https://www.bls.gov/web/empsit/cpseea10.htm"
url_30 <- "https://www.bls.gov/web/empsit/cpseea30.htm"
# Chunk 3
head(df_tb9  <- as.data.frame(html_table(read_html(url_9))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
# Chunk 4
head(df_tb10 <- as.data.frame(html_table(read_html(url_10))[[2]]),5)%>%
reactable(highlight = TRUE, pagination = FALSE, height = 450)
head(df_tb30 <- as.data.frame(html_table(read_html(url_30))[[2]]),10)%>%
reactable(highlight = TRUE, pagination = TRUE, height = 850)
View(df_tb30)
